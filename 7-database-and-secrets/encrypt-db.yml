---
integrations:
  - name: nri-flex
    interval: 30s
    config:
      name: postgresDbFlex
      secrets:
        mylogin:
          kind: local # Use Flex local/internal decryption function
          key: N3wR3lic! # Your pass_phrase to encrypt/decrypt the login info
          data: PASTE_ENCRYPTED_CREDENTIALS_HERE
          type: equal
          # Run the following command to generate a encrypted login info, paste it to the above -> data
          # ./nri-flex -encrypt_pass 'username=flexuser,password=flexpass' -pass_phrase 'N3wR3lic!'

      apis:
        - database: postgres
          event_type: Lab7Example2
          db_conn: "host=postgres port=5432 user=${secret.mylogin:username} password=${secret.mylogin:password} dbname=flexworkshop sslmode=disable"
          custom_attributes: # applies to all queries
            weather: sunny
            LOCATION: sydney

          db_queries:
            - name: userMetricSample
              event_type: userMetricSample
              run: "SELECT * FROM user_metrics;"
            - name: userJoinSample
              event_type: userJoinSample
              run: "SELECT u.username, u.email, u.is_active, m.login_count, m.session_duration_minutes FROM users u LEFT JOIN user_metrics m ON u.id = m.user_id;"
